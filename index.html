<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>åœ‹å®¶é˜²ç½æ—¥ å­¸ç¿’æˆæœ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft JhengHei', sans-serif;
        }
        .main-container {
            max-width: 900px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .topic-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .option-btn {
            display: block;
            width: 100%;
            text-align: left;
            background: white;
            border: 2px solid #e5e7eb;
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .option-btn:hover {
            border-color: #667eea;
            background: #f0f9ff;
        }
        .option-btn.selected {
            border-color: #667eea;
            background: #eff6ff;
        }
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .stepper-item {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .stepper-item.active {
            background: #667eea;
            color: white;
        }
        .stepper-item.completed {
            background: #10b981;
            color: white;
        }
        .stepper-item.pending {
            background: white;
            color: #6b7280;
            border: 2px solid #d1d5db;
        }
        .photo-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 16px 0;
        }
        .photo-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .progress-fill {
            background: linear-gradient(90deg, #10b981, #34d399);
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        #summary-area {
            display: none;
        }
        #camera-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .camera-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            max-width: 90vw;
            max-height: 90vh;
        }
        #camera-video {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 8px;
        }
        #camera-canvas {
            display: none;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="main-quiz">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="font-size: 2.5rem; font-weight: bold; color: #1e40af; margin-bottom: 10px;">
                    ğŸ›¡ï¸ åœ‹å®¶é˜²ç½æ—¥ å­¸ç¿’æˆæœ
                </h1>
                <p style="color: #6b7280; font-size: 1.1rem;">è«‹å®Œæˆå…­å¤§ä¸»é¡Œå•é¡Œèˆ‡ç…§ç‰‡ï¼Œæœ€å¾ŒåŒ¯å‡ºå°ˆå±¬æˆæœ PDF</p>
            </div>
            
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
            </div>
            
            <div id="stepper" style="display: flex; justify-content: center; margin-bottom: 30px;"></div>
            
            <div id="quiz-content"></div>
        </div>
    </div>

    <div id="summary-area" class="main-container">
        <h2 style="text-align: center; color: #1e40af; margin-bottom: 30px; font-size: 2rem;">å­¸ç¿’æˆæœç¸½è¦½</h2>
        <div id="summary-content"></div>
        <button onclick="downloadPDF()" class="btn btn-primary" style="width: 100%; margin-top: 20px; font-size: 1.1rem;">
            ğŸ“„ åŒ¯å‡ºå­¸ç¿’æˆæœ PDF
        </button>
        <button onclick="location.reload()" class="btn" style="width: 100%; margin-top: 10px; background: #f3f4f6;">
            ğŸ”„ é‡æ–°å¡«å¯«
        </button>
    </div>

    <div id="camera-modal">
        <div class="camera-container">
            <h3 style="margin-bottom: 15px;">ğŸ“· æ‹æ”ç…§ç‰‡</h3>
            <video id="camera-video" autoplay playsinline></video>
            <canvas id="camera-canvas"></canvas>
            <div style="margin-top: 15px;">
                <button onclick="capturePhoto()" class="btn btn-primary">ğŸ“¸ æ‹ç…§</button>
                <button onclick="closeCameraModal()" class="btn" style="background: #ef4444; color: white; margin-left: 10px;">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        const topics = [
            {
                title: "é˜²ç½å­¸ç¿’ä¸»é¡Œå€",
                question: "ç•¶é¢è‡¨çªç™¼åœ°éœ‡æ™‚ï¼Œä¸‹åˆ—å“ªä¸€é …ä¸æ˜¯æ­£ç¢ºçš„é¿é›£æ‡‰è®Šæ–¹å¼ï¼Ÿ",
                options: [
                    "A. å°±åœ°å°‹æ‰¾å …å›ºæ¡Œæ¤…ä¸‹æ–¹è¹²ä¸‹æ©è­·",
                    "B. ç¬¬ä¸€æ™‚é–“è·‘åˆ°é™½å°æˆ–æ¨“æ¢¯é–“",
                    "C. ç”¨æ‰‹è­·ä½é ­éƒ¨ï¼Œä¿è­·è‡ªèº«é‡è¦éƒ¨ä½",
                    "D. ç­‰åœ°éœ‡åœæ­¢å¾Œå†ä¾æŒ‡ç¤ºæœ‰ç§©åºæ’¤é›¢å»ºç¯‰ç‰©"
                ],
                answer: 1,
                explanation: "åœ°éœ‡æ™‚æ‡‰å…ˆåœ¨å®‰å…¨è™•è¹²ä¸‹æ©è­·ï¼Œçµ•ä¸æ‡‰ç¬¬ä¸€æ™‚é–“è·‘åˆ°é™½å°æˆ–æ¨“æ¢¯é–“ï¼Œé€™äº›åœ°æ–¹å±éšªä¸”å®¹æ˜“å€’å¡Œã€‚"
            },
            {
                title: "å¸‚åºœç½å®³é˜²æ•‘å®£å°ä¸»é¡Œå€",
                question: "è‡ºåŒ—å¸‚æ”¿åºœåœ¨ç½å®³ç™¼ç”Ÿå¾Œï¼Œç‚ºå”åŠ©æ°‘çœ¾ç½å¾Œå¾©åŸï¼Œä¸‹åˆ—å“ªä¸€é …ä¸æ˜¯å¸‚åºœå–®ä½å¯ä»¥æä¾›çš„å”åŠ©ï¼Ÿ",
                options: [
                    "A. ç½å®³æå¤±ç¨…ææ¸›å…",
                    "B. ä¸å‹•ç”¢äº¤æ˜“å®‰å…¨è«®è©¢",
                    "C. ç½æ°‘å®‰ç½®èˆ‡å¿ƒç†è¼”å°",
                    "D. å…è²»è´ˆé€æ–°æˆ¿å±‹"
                ],
                answer: 3,
                explanation: "å¸‚åºœæœƒæä¾›å¤šå…ƒå”åŠ©å¦‚ç¨…ææ¸›å…ã€å®‰ç½®åŠå¿ƒç†è¼”å°ï¼Œä½†ä¸æœƒç›´æ¥å…è²»è´ˆé€æ–°æˆ¿å±‹ã€‚"
            },
            {
                title: "ç’°å¢ƒæ°¸çºŒä¸»é¡Œå€",
                question: "ç‚ºäº†é”åˆ°ç’°å¢ƒæ°¸çºŒï¼Œä¸‹åˆ—å“ªä¸€ç¨®æ—¥å¸¸è¡Œç‚ºæœ€æœ‰åŠ©æ–¼æ¸›ç·©å…¨çƒæš–åŒ–åŠæ¸›å°‘ç¢³æ’æ”¾ï¼Ÿ",
                options: [
                    "A. å¤šæ­ä¹˜å¤§çœ¾é‹è¼¸å·¥å…·å–ä»£é–‹è»Š",
                    "B. å¸¸ç”¨ä¸€æ¬¡æ€§å¡‘è† ç”¢å“ï¼Œå› ç‚ºæ–¹ä¾¿",
                    "C. æŠŠå¯å›æ”¶çš„ç‰©å“ç›´æ¥ä¸Ÿé€²åƒåœ¾æ¡¶",
                    "D. å¤å¤©å°‡å†·æ°£æº«åº¦è¨­å®šç‚ºæœ€ä½ä¸¦é•·æ™‚é–“ä½¿ç”¨"
                ],
                answer: 0,
                explanation: "æ­ä¹˜å¤§çœ¾é‹è¼¸å¯æœ‰æ•ˆæ¸›å°‘ç¢³æ’æ”¾ï¼Œæ˜¯æœ€æœ‰åŠ©æ–¼ç’°å¢ƒæ°¸çºŒçš„æ—¥å¸¸è¡Œç‚ºã€‚"
            },
            {
                title: "å¤šå…ƒåœ‹éš›ä¸»é¡Œå€",
                question: "åœ‹å®¶é˜²ç½æ—¥æ´»å‹•é‚€è«‹å¤šåœ‹åœ˜é«”å…±åŒåƒèˆ‡ï¼Œé€™éº¼åšçš„ä¸»è¦ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ",
                options: [
                    "A. è®“å¤§å®¶æ¯”è³½èª°çš„é˜²ç½çŸ¥è­˜æœ€å¼·",
                    "B. è®“ä¸åŒåœ‹ç±çš„äººåªé—œå¿ƒè‡ªå·±åœ‹å®¶çš„é˜²ç½æ–¹å¼",
                    "C. ä¿ƒé€²ä¸åŒæ–‡åŒ–ä¹‹é–“çš„äº¤æµï¼Œå­¸ç¿’å„åœ‹é˜²ç½ç¶“é©—",
                    "D. æ¸›å°‘å°ç£æœ¬åœ°å±…æ°‘åƒèˆ‡é˜²ç½æ´»å‹•çš„æ©Ÿæœƒ"
                ],
                answer: 2,
                explanation: "å¤šåœ‹åƒèˆ‡æ˜¯ç‚ºäº†æ–‡åŒ–äº¤æµèˆ‡äº’å­¸ï¼Œå¢å¼·æ•´é«”ç¤¾æœƒé˜²ç½èƒ½åŠ›ã€‚"
            },
            {
                title: "åœ‹è»å®ˆè­·ä¸»é¡Œå€",
                question: "é—œæ–¼åœ‹è»åœ¨å¤©ç„¶ç½å®³ä¸­çš„è§’è‰²ï¼Œä¸‹åˆ—å“ªä¸€é …æè¿°æœ€æ­£ç¢ºï¼Ÿ",
                options: [
                    "A. åœ‹è»åƒ…è² è²¬æˆ°çˆ­æ™‚æœŸçš„è»äº‹è¡Œå‹•ï¼Œå¹³æ™‚ä¸åƒèˆ‡ç½å®³æ•‘æ´",
                    "B. åœ‹è»å¹³æ™‚çµåˆåœ°æ–¹æ”¿åºœï¼Œä¸»å‹•è¦åŠƒä¸¦æŠ•å…¥ç½å®³æ•‘æ´",
                    "C. åœ‹è»åªè² è²¬ç¶­æŒç§©åºï¼Œä¸æœƒå‹•ç”¨å°ˆæ¥­æ•‘ç½éƒ¨éšŠæˆ–å™¨æ",
                    "D. åœ‹è»åœ¨ç½å®³ç™¼ç”Ÿæ™‚æ¯”æ¶ˆé˜²éšŠæ›´æ™šæŠµé”ç¾å ´"
                ],
                answer: 1,
                explanation: "åœ‹è»æœƒçµåˆåœ°æ–¹æ”¿åºœï¼Œä¸»å‹•æŠ•å…¥æ•‘ç½ï¼Œå®ˆè­·æ°‘çœ¾å®‰å…¨ã€‚"
            },
            {
                title: "é˜²ç½é«”é©—ä¸»é¡Œå€",
                question: "åƒåŠ ã€Œåœ°éœ‡æ±‚ç”Ÿ72å°æ™‚ã€é«”é©—æ´»å‹•ï¼Œå­¸ç¿’çš„æœ€é‡è¦æ ¸å¿ƒè§€å¿µç‚ºä½•ï¼Ÿ",
                options: [
                    "A. åªè¦æœ‰æ‰‹æ©Ÿå°±ä¸ç”¨æº–å‚™å…¶ä»–ç‰©è³‡",
                    "B. å­¸æœƒå–„ç”¨æ—¥å¸¸ç‰©å“åŠå…·å‚™è‡ªæ•‘èƒ½åŠ›",
                    "C. ç½å®³ä¾†è‡¨æ™‚åªä¾è³´ä»–äººæ•‘æ´",
                    "D. ç½å®³ç™¼ç”Ÿæ™‚ç¬¬ä¸€æ™‚é–“æ‹ç…§ä¸Šå‚³ç¤¾ç¾¤ç¶²ç«™"
                ],
                answer: 1,
                explanation: "é‡é»åœ¨å­¸æœƒè‡ªæ•‘èˆ‡å–„ç”¨æ—¥å¸¸ç‰©è³‡ï¼Œæå‡é¢å°ç½å®³çš„ç”Ÿå­˜èƒ½åŠ›ã€‚"
            }
        ];

        let currentQuestion = 0;
        let userAnswers = Array(topics.length).fill(null);
        let photos = Array(topics.length).fill(null);

        function updateProgress() {
            const answeredQuestions = userAnswers.filter(a => a !== null).length;
            const uploadedPhotos = photos.filter(p => p !== null).length;
            const totalProgress = (answeredQuestions + uploadedPhotos) / (topics.length * 2) * 100;
            document.getElementById('progress-fill').style.width = totalProgress + '%';
        }

        function renderStepper() {
            let html = '';
            for (let i = 0; i < topics.length; i++) {
                const isActive = currentQuestion === i;
                const isCompleted = userAnswers[i] !== null && photos[i] !== null;
                const className = isActive ? 'active' : isCompleted ? 'completed' : 'pending';
                html += `<div class="stepper-item ${className}">${i + 1}</div>`;
            }
            document.getElementById('stepper').innerHTML = html;
        }

        function renderQuestion() {
            const topic = topics[currentQuestion];
            let optionsHtml = '';
            
            for (let i = 0; i < topic.options.length; i++) {
                const selected = userAnswers[currentQuestion] === i ? 'selected' : '';
                optionsHtml += `<button class="option-btn ${selected}" onclick="selectAnswer(${i})">${topic.options[i]}</button>`;
            }

            const photoDisplay = photos[currentQuestion] ? 
                `<img src="${photos[currentQuestion]}" class="photo-preview" style="display: block; margin: 10px auto;">` : 
                '<div style="color: #9ca3af; font-style: italic; margin: 10px 0;">å°šæœªä¸Šå‚³ç…§ç‰‡</div>';

            document.getElementById('quiz-content').innerHTML = `
                <div class="topic-card">
                    <h3 style="color: #1e40af; font-size: 1.3rem; margin-bottom: 15px;">
                        ${currentQuestion + 1}. ${topic.title}
                    </h3>
                    <p style="margin-bottom: 20px; line-height: 1.6; font-size: 1.05rem;">${topic.question}</p>
                    ${optionsHtml}
                    <div id="explanation" style="margin-top: 15px; min-height: 20px;"></div>
                    
                    <div class="photo-area">
                        <p style="margin-bottom: 15px; font-weight: 600; color: #374151;">ğŸ“¸ ä¸Šå‚³å­¸ç¿’ç…§ç‰‡</p>
                        <input type="file" accept="image/*" onchange="uploadPhoto(event)" style="margin-bottom: 15px;">
                        <div>
                            <button onclick="openCamera()" class="btn" style="background: #10b981; color: white; margin-right: 10px;">ğŸ“· å³æ™‚æ‹ç…§</button>
                            ${photos[currentQuestion] ? '<button onclick="removePhoto()" class="btn" style="background: #ef4444; color: white;">ğŸ—‘ï¸ ç§»é™¤ç…§ç‰‡</button>' : ''}
                        </div>
                        ${photoDisplay}
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 25px;">
                        <button onclick="prevQuestion()" ${currentQuestion === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''} class="btn" style="background: #f3f4f6;">â† ä¸Šä¸€é¡Œ</button>
                        <button onclick="nextQuestion()" class="btn btn-primary">${currentQuestion === topics.length - 1 ? 'å®Œæˆæ¸¬é©— âœ“' : 'ä¸‹ä¸€é¡Œ â†’'}</button>
                    </div>
                </div>
            `;
            
            renderStepper();
            updateProgress();
            showExplanation();
        }

        function selectAnswer(index) {
            userAnswers[currentQuestion] = index;
            renderQuestion();
        }

        function showExplanation() {
            const explanationDiv = document.getElementById('explanation');
            if (userAnswers[currentQuestion] !== null) {
                const isCorrect = userAnswers[currentQuestion] === topics[currentQuestion].answer;
                const icon = isCorrect ? 'âœ…' : 'âŒ';
                const color = isCorrect ? '#059669' : '#dc2626';
                const bgColor = isCorrect ? '#f0fdf4' : '#fef2f2';
                const text = isCorrect ? 'ç­”å°äº†ï¼' : 'ç­”éŒ¯äº†ã€‚';
                explanationDiv.innerHTML = `
                    <div style="background: ${bgColor}; border-left: 4px solid ${color}; padding: 15px; border-radius: 6px;">
                        <div style="color: ${color}; font-weight: 600; margin-bottom: 8px;">${icon} ${text}</div>
                        <div style="line-height: 1.5;">${topics[currentQuestion].explanation}</div>
                    </div>
                `;
            } else {
                explanationDiv.innerHTML = '';
            }
        }

        function uploadPhoto(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photos[currentQuestion] = e.target.result;
                    renderQuestion();
                };
                reader.readAsDataURL(file);
            }
        }

        function removePhoto() {
            photos[currentQuestion] = null;
            renderQuestion();
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        function nextQuestion() {
            if (userAnswers[currentQuestion] === null) {
                alert('è«‹å…ˆå›ç­”å•é¡Œå†é€²å…¥ä¸‹ä¸€é¡Œï¼');
                return;
            }
            if (photos[currentQuestion] === null) {
                alert('è«‹å…ˆä¸Šå‚³ç…§ç‰‡å†é€²å…¥ä¸‹ä¸€é¡Œï¼');
                return;
            }
            
            if (currentQuestion < topics.length - 1) {
                currentQuestion++;
                renderQuestion();
            } else {
                showSummary();
            }
        }

        function showSummary() {
            document.getElementById('main-quiz').parentElement.style.display = 'none';
            document.getElementById('summary-area').style.display = 'block';
            
            const correctCount = userAnswers.filter((answer, index) => answer === topics[index].answer).length;
            const percentage = Math.round((correctCount / topics.length) * 100);
            
            let summaryHtml = `
                <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.8rem;">ğŸ›¡ï¸ åœ‹å®¶é˜²ç½æ—¥å­¸ç¿’æˆæœ</h3>
                    <p style="margin: 0 0 8px 0; font-size: 1.1rem;">å°åŒ—å¸‚æ”¿åºœæ¶ˆé˜²å±€</p>
                    <p style="margin: 0; opacity: 0.9;">${new Date().toLocaleDateString('zh-TW')} | æˆç¸¾ï¼š${correctCount}/${topics.length} é¡Œæ­£ç¢º (${percentage}%)</p>
                </div>
            `;
            
            for (let i = 0; i < topics.length; i++) {
                const isCorrect = userAnswers[i] === topics[i].answer;
                const userAnswer = topics[i].options[userAnswers[i]];
                const correctAnswer = topics[i].options[topics[i].answer];
                
                summaryHtml += `
                    <div style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 20px; background: white;">
                        <div style="display: flex; gap: 20px; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h4 style="color: #1e40af; margin: 0 0 10px 0; font-size: 1.2rem;">
                                    ${i + 1}. ${topics[i].title}
                                </h4>
                                <p style="margin: 0 0 15px 0; line-height: 1.6;">${topics[i].question}</p>
                                <div style="margin-bottom: 10px;">
                                    <strong>ä½ çš„ç­”æ¡ˆï¼š</strong>
                                    <span style="color: ${isCorrect ? '#059669' : '#dc2626'}; font-weight: 600;">${userAnswer}</span>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <strong>æ­£ç¢ºç­”æ¡ˆï¼š</strong>
                                    <span style="color: #059669; font-weight: 600;">${correctAnswer}</span>
                                </div>
                                <div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 12px; border-radius: 6px;">
                                    <strong>ğŸ’¡ è§£æï¼š</strong>${topics[i].explanation}
                                </div>
                            </div>
                            <div style="flex-shrink: 0;">
                                ${photos[i] ? 
                                    `<img src="${photos[i]}" style="width: 180px; height: 135px; object-fit: contain; border: 2px solid #e5e7eb; border-radius: 8px; background: white;">` : 
                                    `<div style="width: 180px; height: 135px; border: 2px dashed #d1d5db; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #9ca3af; text-align: center; font-size: 0.9rem;">ğŸ“·<br>æœªä¸Šå‚³ç…§ç‰‡</div>`
                                }
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('summary-content').innerHTML = summaryHtml;
        }

        function downloadPDF() {
            const element = document.getElementById('summary-content');
            html2pdf(element, {
                margin: 0.5,
                filename: 'åœ‹å®¶é˜²ç½æ—¥å­¸ç¿’æˆæœ.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            });
        }

        // æ‹ç…§åŠŸèƒ½
        let cameraStream = null;

        function openCamera() {
            const modal = document.getElementById('camera-modal');
            const video = document.getElementById('camera-video');
            
            modal.style.display = 'flex';
            
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            })
            .then(stream => {
                cameraStream = stream;
                video.srcObject = stream;
            })
            .catch(err => {
                alert('ç„¡æ³•é–‹å•Ÿæ”å½±æ©Ÿï¼Œè«‹ä½¿ç”¨æª”æ¡ˆä¸Šå‚³åŠŸèƒ½');
                closeCameraModal();
            });
        }

        function closeCameraModal() {
            const modal = document.getElementById('camera-modal');
            const video = document.getElementById('camera-video');
            
            modal.style.display = 'none';
            
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            video.srcObject = null;
        }

        function capturePhoto() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            photos[currentQuestion] = canvas.toDataURL('image/jpeg', 0.8);
            closeCameraModal();
            renderQuestion();
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            renderQuestion();
        };
    </script>
</body>
</html>
