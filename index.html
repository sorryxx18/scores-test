<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>消防體能測驗數據分析平台</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-bg: #f0f2f5; 
            --sidebar-bg: #001529;
            --header-bg: #ffffff;
            --card-bg: #ffffff;
            --primary-text: #333333;
            --secondary-text: #777777;
            --primary-blue: #1890ff; 
            --border-color: #e8e8e8;
            --color-excellent: #389e0d;
            --color-good: #1890ff;
            --color-pass: #faad14;
            --color-fail: #d4380d;
            --color-female: #722ed1;
        }
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--primary-bg); color: var(--primary-text); display: flex; height: 100vh; overflow: hidden; position: relative; }
        .sidebar { width: 220px; background-color: var(--sidebar-bg); color: white; flex-shrink: 0; display: flex; flex-direction: column; transition: width 0.3s ease; z-index: 100; }
        .main-container { flex-grow: 1; display: flex; flex-direction: column; height: 100vh; overflow: hidden; transition: margin-left 0.3s ease; }
        .header { background-color: var(--header-bg); padding: 0 24px; height: 64px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); flex-shrink: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
        .content-area { padding: 24px; flex-grow: 1; overflow: auto; display: flex; flex-direction: column; }
        .dashboard-grid { flex-grow: 1; display: grid; grid-template-columns: 2fr 1fr; grid-template-rows: auto auto 1fr; gap: 24px; }
        .header-filters { grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; padding: 10px 0; }
        .kpi-grid { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; }
        .main-panel { grid-column: 1 / 2; grid-row: 3 / 4; }
        .side-panel { grid-column: 2 / 3; grid-row: 3 / 4; display: flex; flex-direction: column; gap: 24px; }
        .sidebar-header, .sidebar-menu li, .sidebar-footer { white-space: nowrap; }
        .sidebar-header { padding: 16px 24px; font-size: 20px; font-weight: 700; display: flex; align-items: center; }
        .sidebar-header i { margin-right: 12px; color: var(--primary-blue); font-size: 24px; }
        .sidebar-menu { list-style: none; }
        .sidebar-menu li { padding: 14px 24px; cursor: pointer; transition: all 0.3s ease; font-size: 16px; display: flex; align-items: center; border-left: 4px solid transparent; }
        .sidebar-menu li:hover, .sidebar-menu li.active { background-color: rgba(24, 144, 255, 0.1); border-left-color: var(--primary-blue); }
        .sidebar-menu li i { margin-right: 10px; width: 20px; text-align: center; font-size: 18px; }
        .sidebar-footer { margin-top: auto; padding: 16px 24px; font-size: 12px; color: var(--secondary-text); text-align: center; border-top: 1px solid rgba(255,255,255,0.1); }
        .page-title { font-size: 20px; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        .filters, .action-buttons { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        select, button { padding: 8px 12px; border-radius: 4px; border: 1px solid #d9d9d9; background-color: #fff; font-family: 'Noto Sans TC', sans-serif; font-size: 14px; cursor: pointer; transition: all 0.2s; }
        button.primary { background-color: var(--primary-blue); color: white; border-color: var(--primary-blue); }
        .card { background-color: var(--card-bg); border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09); display: flex; flex-direction: column; height: 100%; }
        .card-title { margin: 0 0 16px 0; font-size: 18px; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        .kpi-card { flex-direction: row; align-items: center; gap: 16px; }
        .kpi-card .icon { font-size: 32px; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(24, 144, 255, 0.1); }
        .kpi-card .value { font-size: 24px; font-weight: 700; }
        .kpi-card .label { font-size: 14px; color: var(--secondary-text); margin-bottom: 4px; }
        .kpi-card .count { font-size: 12px; color: var(--secondary-text); }
        .radar-grid-container { flex-grow: 1; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 20px; }
        .radar-item { position: relative; background: #f9f9f9; border-radius: 6px; padding: 15px; display: flex; flex-direction: column; }
        .radar-item .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .radar-item .chart-title { font-weight: bold; font-size: 16px; }
        .radar-item .chart-subtitle { font-size: 13px; color: var(--secondary-text); }
        .chart-wrapper { position: relative; flex-grow: 1; min-height: 150px; }
        .data-table-container { overflow-y: auto; flex-grow: 1; }
        table.data-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .data-table th, .data-table td { padding: 10px 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .data-table thead th { background-color: #fafafa; font-weight: 500; position: sticky; top: 0; }
        .data-table tbody tr:hover { background-color: #e6f7ff; }
        .badge { display: inline-block; padding: 2px 8px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .badge.excellent { background: rgba(56, 158, 13, 0.1); color: var(--color-excellent); }
        .badge.good { background: rgba(24, 144, 255, 0.1); color: var(--color-good); }
        .badge.pass { background: rgba(250, 173, 20, 0.1); color: var(--color-pass); }
        .badge.fail { background: rgba(212, 56, 13, 0.1); color: var(--color-fail); }
        .current-time { position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; z-index: 50; }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-header"><i class="fa-solid fa-fire-extinguisher"></i><span>消防數據分析平台</span></div>
        <ul class="sidebar-menu">
            <li class="active"><i class="fa-solid fa-chart-pie"></i><span>總覽儀表板</span></li>
            <li><i class="fa-solid fa-table-list"></i><span>詳細數據查詢</span></li>
            <li><i class="fa-solid fa-ranking-star"></i><span>個人成績分析</span></li>
        </ul>
        <div class="sidebar-footer">消防局 版權所有 © 2025</div>
    </nav>
    
    <div class="main-container">
        <header class="header">
            <h1 class="page-title"><i class="fa-solid fa-chart-line"></i>總覽儀表板</h1>
            <div class="user-info">
                 <button class="secondary"><i class="fa-solid fa-user"></i> 管理員</button>
            </div>
        </header>
        
        <main class="content-area">
            <div class="dashboard-grid">
                <div class="header-filters">
                    <div class="filters">
                        <div class="filter-group">
                            <label for="unit"><i class="fa-solid fa-people-group"></i> 大隊：</label>
                            <select id="unit">
                                <option>全部大隊</option>
                                <option>第一大隊</option>
                                <option>第二大隊</option>
                                <option>第三大隊</option>
                                <option>第四大隊</option>
                            </select>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="primary"><i class="fa-solid fa-file-download"></i> 產生報表</button>
                    </div>
                </div>

                <div class="kpi-grid">
                    <div class="card kpi-card">
                        <div class="icon" style="color:var(--color-excellent)"><i class="fa-solid fa-award"></i></div>
                        <div>
                            <div class="label">菁英人員</div>
                            <div class="value" id="kpi-excellent-perc"></div>
                            <div class="count" id="kpi-excellent-count"></div>
                        </div>
                    </div>
                    <div class="card kpi-card">
                        <div class="icon" style="color:var(--color-good)"><i class="fa-solid fa-thumbs-up"></i></div>
                        <div>
                            <div class="label">良好人員</div>
                            <div class="value" id="kpi-good-perc"></div>
                            <div class="count" id="kpi-good-count"></div>
                        </div>
                    </div>
                    <div class="card kpi-card">
                        <div class="icon" style="color:var(--color-pass)"><i class="fa-solid fa-check"></i></div>
                        <div>
                            <div class="label">合格人員</div>
                            <div class="value" id="kpi-pass-perc"></div>
                            <div class="count" id="kpi-pass-count"></div>
                        </div>
                    </div>
                    <div class="card kpi-card">
                        <div class="icon" style="color:var(--color-fail)"><i class="fa-solid fa-person-running"></i></div>
                        <div>
                            <div class="label">待加強人員</div>
                            <div class="value" id="kpi-fail-perc"></div>
                            <div class="count" id="kpi-fail-count"></div>
                        </div>
                    </div>
                </div>
                
                <div class="main-panel card">
                    <h2 class="card-title"><i class="fa-solid fa-chart-radar"></i>各大隊戰力分析 (總成績)</h2>
                    <div class="radar-grid-container">
                        <div class="radar-item">
                            <div class="chart-header">
                                <div class="chart-title">第一大隊</div>
                                <div class="chart-subtitle" id="total-battalion-1"></div>
                            </div>
                            <div class="chart-wrapper"><canvas id="radarChart1"></canvas></div>
                        </div>
                        <div class="radar-item">
                            <div class="chart-header">
                                <div class="chart-title">第二大隊</div>
                                <div class="chart-subtitle" id="total-battalion-2"></div>
                            </div>
                            <div class="chart-wrapper"><canvas id="radarChart2"></canvas></div>
                        </div>
                        <div class="radar-item">
                            <div class="chart-header">
                                <div class="chart-title">第三大隊</div>
                                <div class="chart-subtitle" id="total-battalion-3"></div>
                            </div>
                            <div class="chart-wrapper"><canvas id="radarChart3"></canvas></div>
                        </div>
                        <div class="radar-item">
                            <div class="chart-header">
                                <div class="chart-title">第四大隊</div>
                                <div class="chart-subtitle" id="total-battalion-4"></div>
                            </div>
                            <div class="chart-wrapper"><canvas id="radarChart4"></canvas></div>
                        </div>
                    </div>
                </div>
                
                <div class="side-panel">
                    <div class="card">
                        <h3 class="card-title"><i class="fa-solid fa-user-group"></i> 受測人員年齡層分佈</h3>
                        <div class="chart-wrapper"><canvas id="ageDistributionChart"></canvas></div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title"><i class="fa-solid fa-medal"></i> 1500M 成績優異人員 (Top 5)</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead><tr><th>排名</th><th>姓名</th><th>大隊</th><th>分隊</th><th>成績</th><th>等級</th></tr></thead>
                                <tbody id="leaderboard-body"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title"><i class="fa-solid fa-chart-column"></i> 大隊1500M平均成績比較</h3>
                        <div class="chart-wrapper"><canvas id="comparisonChart"></canvas></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div class="current-time"><i class="fa-solid fa-clock"></i> <span id="time-display"></span></div>

    <script>
    // =================================================================
    // === 數據中心 (Data Hub) ===
    // 未來只需要更新此處的 `dashboardData` 物件，整個頁面就會自動變化
    // =================================================================
    const dashboardData = {
        // 1. KPI 關鍵指標數據
        kpi: {
            excellent: { percentage: 28, count: 405 },
            good:      { percentage: 41, count: 595 },
            pass:      { percentage: 21, count: 305 },
            fail:      { percentage: 10, count: 145 }
        },
        // 2. 各大隊戰力雷達圖數據
        radar: {
            battalion1: { total: 352, distribution: [27, 43, 23, 7] }, // [菁英%, 良好%, 合格%, 待加強%]
            battalion2: { total: 328, distribution: [35, 46, 14, 5] },
            battalion3: { total: 385, distribution: [32, 41, 20, 7] },
            battalion4: { total: 365, distribution: [23, 37, 29, 11] }
        },
        // 3. 年齡分佈圖數據
        ageDistribution: {
            labels: ['20-29歲', '30-39歲', '40-49歲', '50+歲', '女性'],
            counts: [201, 450, 589, 157, 50]
        },
        // 4. 1500M 菁英榜數據
        leaderboard: [
            { rank: 1, name: '林昶輔', battalion: '第三大隊', station: '安和分隊', time: "5'17\"", grade: '菁英級', gradeClass: 'excellent' },
            { rank: 2, name: '李皆賢', battalion: '第三大隊', station: '永樂分隊', time: "5'28\"", grade: '菁英級', gradeClass: 'excellent' },
            { rank: 3, name: '曾麟宗', battalion: '第四大隊', station: '南港分隊', time: "5'30\"", grade: '菁英級', gradeClass: 'excellent' },
            { rank: 4, name: '蔡孟杰', battalion: '第二大隊', station: '中山分隊', time: "5'33\"", grade: '菁英級', gradeClass: 'excellent' },
            { rank: 5, name: '林敬凱', battalion: '第一大隊', station: '大安分隊', time: "5'36\"", grade: '菁英級', gradeClass: 'excellent' }
        ],
        // 5. 各大隊 1500M 平均成績比較數據 (單位: 分鐘)
        comparison: {
            labels: ['第一大隊', '第二大隊', '第三大隊', '第四大隊'],
            averages: [7.2, 6.8, 6.5, 7.5]
        }
    };

    // =================================================================
    // === 頁面渲染與圖表生成 (Page Rendering & Chart Generation) ===
    // 下方的程式碼會自動讀取上面的 `dashboardData` 物件來產生畫面
    // 一般情況下無需修改
    // =================================================================
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- 1. 填充 KPI 數據 ---
        document.getElementById('kpi-excellent-perc').textContent = dashboardData.kpi.excellent.percentage + '%';
        document.getElementById('kpi-excellent-count').textContent = `(${dashboardData.kpi.excellent.count}人)`;
        document.getElementById('kpi-good-perc').textContent = dashboardData.kpi.good.percentage + '%';
        document.getElementById('kpi-good-count').textContent = `(${dashboardData.kpi.good.count}人)`;
        document.getElementById('kpi-pass-perc').textContent = dashboardData.kpi.pass.percentage + '%';
        document.getElementById('kpi-pass-count').textContent = `(${dashboardData.kpi.pass.count}人)`;
        document.getElementById('kpi-fail-perc').textContent = dashboardData.kpi.fail.percentage + '%';
        document.getElementById('kpi-fail-count').textContent = `(${dashboardData.kpi.fail.count}人)`;

        // --- 2. 產生雷達圖 ---
        const radarLabels = ['菁英級', '良好級', '合格級', '待加強'];
        const radarColors = {
            'radarChart1': '24, 144, 255', // Blue
            'radarChart2': '82, 196, 26',  // Green
            'radarChart3': '250, 173, 20', // Orange
            'radarChart4': '245, 34, 45'  // Red
        };

        function createRadarChart(canvasId, data, color, totalCount) {
            document.getElementById(`total-${canvasId.replace('Chart', '-battalion-')}`).textContent = `總人數: ${totalCount}人`;
            new Chart(document.getElementById(canvasId), {
                type: 'radar',
                data: {
                    labels: radarLabels,
                    datasets: [{
                        data: data,
                        borderColor: `rgba(${color}, 1)`,
                        backgroundColor: `rgba(${color}, 0.2)`,
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { r: { min: 0, max: 50, ticks: { stepSize: 10, display: false } } },
                    plugins: { legend: { display: false }, datalabels: { formatter: (v) => v + '%' } }
                },
                plugins: [ChartDataLabels]
            });
        }
        createRadarChart('radarChart1', dashboardData.radar.battalion1.distribution, radarColors.radarChart1, dashboardData.radar.battalion1.total);
        createRadarChart('radarChart2', dashboardData.radar.battalion2.distribution, radarColors.radarChart2, dashboardData.radar.battalion2.total);
        createRadarChart('radarChart3', dashboardData.radar.battalion3.distribution, radarColors.radarChart3, dashboardData.radar.battalion3.total);
        createRadarChart('radarChart4', dashboardData.radar.battalion4.distribution, radarColors.radarChart4, dashboardData.radar.battalion4.total);
        
        // --- 3. 產生年齡分佈圖 ---
        new Chart(document.getElementById('ageDistributionChart'), {
            type: 'doughnut',
            data: {
                labels: dashboardData.ageDistribution.labels,
                datasets: [{
                    data: dashboardData.ageDistribution.counts,
                    backgroundColor: [
                        'rgba(24, 144, 255, 0.8)', 'rgba(82, 196, 26, 0.8)', 'rgba(250, 173, 20, 0.8)',
                        'rgba(245, 34, 45, 0.8)', 'rgba(114, 46, 209, 0.8)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false, cutout: '65%',
                plugins: {
                    legend: { position: 'bottom', labels: { padding: 15, usePointStyle: true } },
                    tooltip: {
                        callbacks: {
                            label: function(c) {
                                const total = c.chart.getDatasetMeta(0).total;
                                return `${c.label}: ${c.raw}人 (${Math.round((c.raw / total) * 100)}%)`;
                            }
                        }
                    }
                }
            }
        });
        
        // --- 4. 填充排行榜 ---
        const leaderboardBody = document.getElementById('leaderboard-body');
        leaderboardBody.innerHTML = dashboardData.leaderboard.map(p => `
            <tr>
                <td class="rank">${p.rank}</td>
                <td>${p.name}</td>
                <td>${p.battalion}</td>
                <td>${p.station}</td>
                <td>${p.time}</td>
                <td><span class="badge ${p.gradeClass}">${p.grade}</span></td>
            </tr>
        `).join('');

        // --- 5. 產生大隊比較圖 ---
        new Chart(document.getElementById('comparisonChart'), {
            type: 'bar',
            data: {
                labels: dashboardData.comparison.labels,
                datasets: [{
                    data: dashboardData.comparison.averages,
                    backgroundColor: ['rgba(24, 144, 255, 0.7)', 'rgba(82, 196, 26, 0.7)', 'rgba(250, 173, 20, 0.7)', 'rgba(245, 34, 45, 0.7)'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, title: { display: true, text: '分鐘' } } },
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: (c) => `平均成績: ${c.parsed.y} 分鐘` } },
                    datalabels: { anchor: 'end', align: 'top', formatter: (v) => v + '分' }
                }
            },
            plugins: [ChartDataLabels]
        });

        // --- 其他 UI 功能 ---
        function updateTime() {
            document.getElementById('time-display').textContent = new Date().toLocaleString('zh-TW', { hour12: false });
        }
        setInterval(updateTime, 1000);
        updateTime();
    });
    </script>
</body>
</html>
