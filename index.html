<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>國家防災日 學習成果</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
      min-height: 100vh;
    }
    .gradient-header {
      background: linear-gradient(to right, #ff512f, #dd2476);
      color: white;
    }
    .shadow-soft {
      box-shadow: 0 10px 15px rgba(0,0,0,0.1);
    }
    .btn-primary {
      background: linear-gradient(to right, #ff512f, #dd2476);
      color: white;
      transition: transform 0.2s;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
    }
    .option-btn.selected {
      background-color: #ffe0b2;
      border-color: #fb8c00;
      color: #e65100;
    }
    .pdf-photo {
      width: 150px;
      height: 90px;
      object-fit: cover;
      border-radius: 8px;
      margin-left: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      border: 1px solid #e2e8f0;
      background: #fff;
    }
    .question-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 44px;
      border-top-width: 4px;
      border-color: var(--topic-color, #9ca3af);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .topic-title { font-size: 1.1em; color: var(--topic-color, #d32f2f); font-weight: 700; letter-spacing: 1px; }
    .topic-1 { --topic-color: #ef5350; }
    .topic-2 { --topic-color: #ff7043; }
    .topic-3 { --topic-color: #ffca28; }
    .topic-4 { --topic-color: #78909c; }
    .topic-5 { --topic-color: #5d4037; }
    .topic-6 { --topic-color: #424242; }
    .qnum {
      background-color: var(--topic-color, #d32f2f);
      color: #fff;
      border-radius: 6px;
      font-weight: bold;
      padding: 3px 10px;
      margin-right: 10px;
      font-size: 0.9em;
    }
    .page-break { page-break-after: always; }
  </style>
</head>
<body class="p-4 flex justify-center">

<div id="main" class="max-w-3xl w-full bg-white p-8 rounded-xl shadow-soft">
  <div class="text-center mb-6">
    <img id="mainLogo" src="" class="h-16 mx-auto mb-4" alt="Logo">
    <h1 class="text-3xl font-bold gradient-header py-3 rounded-xl shadow-md">國家防災日 學習成果</h1>
  </div>
  <p class="text-center text-gray-600 mb-6">請完成六大主題問題與照片，最後匯出專屬成果 PDF。</p>
  <div id="stepper" class="flex items-center justify-center mb-6"></div>
  <div id="topic-area"></div>
</div>

<div id="summary-area" style="display:none;" class="max-w-3xl w-full bg-white p-8 rounded-xl shadow-soft">
  <div class="text-center mb-6">
    <img id="pdfLogo" src="" class="h-16 mx-auto mb-3" alt="Logo">
    <h2 class="text-2xl font-bold gradient-header py-3 rounded-xl shadow-md">學習成果總覽</h2>
    <p class="text-gray-600 mt-2">臺北市政府消防局 國家防災日</p>
  </div>
  <div id="summary-content"></div>
  <button onclick="downloadPDF()" class="mt-8 w-full btn-primary py-3 rounded-lg shadow">匯出學習成果 PDF</button>
  <button onclick="location.reload()" class="mt-4 w-full bg-gray-200 text-gray-600 py-2 rounded-lg hover:bg-gray-300">重新填寫</button>
</div>

<script>
const base64Logo = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAbFBMVEX////tHCTsAAD84eD+8/L+9/b70tH1o6T5vbrsAADEZ235xMXuTE72s7Tyb3HwhIf2rK7+7u/sERv82dr5wsT5ycncOj/pra/sCgzssLbERkfmaWvkeHvfbm/0k5XygoXqZmfukpPqX1/wgn4W38aVAAADfUlEQVR4nO2dC3OaQBCGUyqggh5QxAcVxf//pSfe0pCkdPaylM3sObN3p2kWFnfXbTYVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4PzK7fJ2ZfT2dJbZ8P5m1S2ZbV3dP1h/yvM3uVq/M3mJ2t2x/k8xWZva3pLePzG4z+/Uw27Nq+zNzYxsbk2M3N2dOto+Y2d3Mru9ZXd+8nBgzs5nN2Zct6y85I1m9ns1OzVz/eMbsVmakx+K8+91uNuNuNuNeP/Mv/f2+s5eYWa5m1zOrV5y1x3I2xmtmN/pD6W+pY/E8bua3D8zW1s1m1r9na/YgM7tld5g135v19/b29k7mM/sHs3vN3s5sW/aDmd0zW1m3fn+zm+1oDCf4I/O3MfBfF87WzA/D+f3MzrY+fnvD+bfwT+b79fXm7pL3s6vM7HdlTw+Z3bE7n/35nE0Wc6b+jPI3s7t3Duf3+2//3o/y50v2fGbvM/uHzO4ze3S31fD5uM8vM7uL2Y1333w/mM0uYvab2cVmz3P+76d/Zzbb39/b/fNn/R/+I/M+sz/fMfvV7E5mH1h/3f2Vv7f794efs/9vZu+wOz/8m/l1zOz04Yf/hM5sZ/+z+x+Z3Xf//kYn02/d/p75NfNvZu+wO//sP8s/ZnaPzJ7c7R+Z/eb/fGbXw/8/s/P/uPvT+f3b39v9k/k/+13/4r8zf+/f/N6d/Uv2x+Z3/s//xvzdv2N/Y/b3/u//yfzW/P4X+7e//8X+k/lf/17/H/k/+z/2F/Z/9x/a37//44fy5//s79n/8+P8b/ev/sP58//sf979k/lf+1/+Uv6v/Nf9n//c/Lf9D/e3/Wf/w//Z/4t/2v+r/xv/5n/i3/3/0v+V/53/7n/j//m/i3/R/+t/K//m/+1/9f/Xv6v/1f+a/+v/Pf+f/W/+v/qf+v/W/9f/u/+P/l//r/5//s//R/9//T/4//D/4v/b//P/r//X/+f+n//v/V/+P/q//X/+v/X/+f+l/9P/h/+n/R//P/7/+LwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD43/wCRGylhQqFApEAAAAASUVORK5CYII=";

const topics = [
  {
    title: "防災學習主題區",
    tclass: "topic-1",
    question: "當面臨突發地震時，下列哪一項不是正確的避難應變方式？",
    options: [
      "A. 就地尋找堅固桌椅下方蹲下掩護",
      "B. 第一時間跑到陽台或樓梯間",
      "C. 用手護住頭部，保護自身重要部位",
      "D. 等地震停止後再依指示有秩序撤離建築物"
    ],
    answer: 1,
    explanation: "地震時應先在安全處蹲下掩護，絕不應第一時間跑到陽台或樓梯間，這些地方危險且容易倒塌。"
  },
  {
    title: "市府災害防救宣導主題區",
    tclass: "topic-2",
    question: "臺北市政府在災害發生後，為協助民眾災後復原，下列哪一項不是市府單位可以提供的協助？",
    options: [
      "A. 災害損失稅捐減免",
      "B. 不動產交易安全諮詢",
      "C. 災民安置與心理輔導",
      "D. 免費贈送新房屋"
    ],
    answer: 3,
    explanation: "市府會提供多元協助如稅捐減免、安置及心理輔導，但不會直接免費贈送新房屋。"
  },
  {
    title: "環境永續主題區",
    tclass: "topic-3",
    question: "為了達到環境永續，下列哪一種日常行為最有助於減緩全球暖化及減少碳排放？",
    options: [
      "A. 多搭乘大眾運輸工具取代開車",
      "B. 常用一次性塑膠產品，因為方便",
      "C. 把可回收的物品直接丟進垃圾桶",
      "D. 夏天將冷氣溫度設定為最低並長時間使用"
    ],
    answer: 0,
    explanation: "搭乘大眾運輸可有效減少碳排放，是最有助於環境永續的日常行為。"
  },
  {
    title: "多元國際主題區",
    tclass: "topic-4",
    question: "國家防災日活動邀請多國團體共同參與，這麼做的主要目的是什麼？",
    options: [
      "A. 讓大家比賽誰的防災知識最強",
      "B. 讓不同國籍的人只關心自己國家的防災方式",
      "C. 促進不同文化之間的交流，學習各國防災經驗",
      "D. 減少台灣本地居民參與防災活動的機會"
    ],
    answer: 2,
    explanation: "多國參與是為了文化交流與互學，增強整體社會防災能力。"
  },
  {
    title: "國軍守護主題區",
    tclass: "topic-5",
    question: "關於國軍在天然災害中的角色，下列哪一項描述最正確？",
    options: [
      "A. 國軍僅負責戰爭時期的軍事行動，平時不參與災害救援",
      "B. 國軍平時結合地方政府，主動規劃並投入災害救援",
      "C. 國軍只負責維持秩序，不會動用專業救災部隊或器材",
      "D. 國軍在災害發生時比消防隊更晚抵達現場"
    ],
    answer: 1,
    explanation: "國軍會結合地方政府，主動投入救災，守護民眾安全。"
  },
  {
    title: "防災體驗主題區",
    tclass: "topic-6",
    question: "參加「地震求生72小時」體驗活動，學習的最重要核心觀念為何？",
    options: [
      "A. 只要有手機就不用準備其他物資",
      "B. 學會善用日常物品及具備自救能力",
      "C. 災害來臨時只依賴他人救援",
      "D. 災害發生時第一時間拍照上傳社群網站"
    ],
    answer: 1,
    explanation: "重點在學會自救與善用日常物資，提升面對災害的生存能力。"
  }
];

let current = 0;
let userAnswers = Array(topics.length).fill(null);
let photos = Array(topics.length).fill(null);

function renderStepper() {
  let html = "";
  topics.forEach((_, i) => {
    const completed = userAnswers[i] !== null && photos[i] !== null;
    const active = i === current;
    let cls = "bg-gray-200 text-gray-700";
    if (active) cls = "bg-red-600 text-white ring-2 ring-offset-2 ring-red-500";
    else if (completed) cls = "bg-green-500 text-white";
    html += `<div class=\"w-8 h-8 rounded-full flex items-center justify-center ${cls} font-bold mx-1\`>${i+1}</div>`;
    if (i < topics.length-1) html += `<div class=\"flex-1 h-1 bg-gray-200\"></div>`;
  });
  document.getElementById('stepper').innerHTML = `<div class=\"w-full flex items-center\">${html}</div>`;
}

function renderTopic() {
  renderStepper();
  const t = topics[current];
  let photoHTML = photos[current]
    ? `<img src=\"${photos[current]}\" class=\"pdf-photo my-2 block\">`
    : `<img class=\"pdf-photo my-2 hidden\" id=\"photo-prev-${current}\">`;
  let opts = '';
  t.options.forEach((opt, idx) => {
    const sel = userAnswers[current]===idx ? 'selected' : '';
    opts += `<button onclick=\"chooseAnswer(${idx})\" class=\"block w-full text-left bg-white hover:bg-red-50 rounded-lg px-4 py-3 my-2 option-btn ${sel}\`>${opt}</button>`;
  });
  document.getElementById('topic-area').innerHTML = `
    <div class=\"question-card ${t.tclass}\">
      <h2 class=\"topic-title mb-3\"><span class=\"qnum\">${current+1}</span>${t.title}</h2>
      <p class=\"text-gray-800 mb-4 leading-relaxed\">${t.question}</p>
      <div>${opts}</div>
      <div id=\"explanation\" class=\"mt-3 mb-3 p-3 rounded-lg\" style=\"display:none;min-height:3em;\"></div>
      <div class=\"mt-4 border-t pt-4\">
        <label class=\"font-semibold text-gray-700\">上傳活動照片 (JPG/PNG)</label>
        <input type=\"file\" accept=\"image/*\" onchange=\"uploadPhoto(event,${current})\" class=\"block my-2 text-sm text-gray-500 file:rounded-full file:bg-red-50 file:text-red-700 hover:file:bg-red-100\">
        ${photoHTML}
      </div>
    </div>
    <div class=\"mt-6 flex justify-between\">
      <button ${current===0?'disabled':''} onclick=\"prevTopic()\" class=\"px-6 py-2 bg-gray-200 rounded-lg ${current===0?'opacity-50 cursor-not-allowed':'hover:bg-gray-300'}\">上一題</button>
      <button onclick=\"nextTopic()\" class=\"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 shadow\">${current<topics.length-1?'下一題':'完成作答'}</button>
    </div>
  `;
  if (userAnswers[current]!==null) showExplanation();
}

function chooseAnswer(i) {
  userAnswers[current]=i; renderTopic();
}

function showExplanation() {
  const idx=userAnswers[current], corr=topics[current].answer;
  const div=document.getElementById('explanation');
  if(idx===corr) {
    div.className='text-green-800 font-semibold bg-green-100 mt-3 mb-3 p-3 rounded-lg';
    div.textContent = '✔️ 答對了！ '+topics[current].explanation;
  } else {
    div.className='text-red-800 font-semibold bg-red-100 mt-3 mb-3 p-3 rounded-lg';
    div.textContent = '❌ 答錯了。 '+topics[current].explanation;
  }
  div.style.display='block';
}

function uploadPhoto(e,i) {
  const f=e.target.files[0];
  if(!f||!f.type.startsWith('image/')){alert('請上傳圖片檔！');return;}
  const r=new FileReader();r.onload=ev=>{photos[i]=ev.target.result;renderStepper();renderTopic();};r.readAsDataURL(f);
}

function prevTopic(){if(current>0){current--;renderTopic();}}
function nextTopic(){
  if(userAnswers[current]===null){alert('請先回答問題！');return;}
  if(photos[current]===null){alert('請先上傳照片！');return;}
  if(current<topics.length-1){current++;renderTopic();}
  else showSummary();
}

function showSummary(){
  document.getElementById('main').style.display='none';
  document.getElementById('summary-area').style.display='block';
  document.getElementById('pdfLogo').src=base64Logo;
  let html='';
  topics.forEach((t,i)=>{
    const ok=userAnswers[i]===t.answer;
    html+=`<div class="question-card summary-card ${t.tclass}">`+
          `<div style=\"flex:1;\">`+
          `<h3 class=\"topic-title mb-2\"><span class=\"qnum\">${i+1}</span>${t.title}</h3>`+
          `<p class=\"text-gray-800 mb-2 font-semibold\">${t.question}</p>`+
          `<p class=\"mb-1 text-sm\">你的答案：<span style=\"color:${ok?'#166534':'#991b1b'};\">${t.options[userAnswers[i]]}</span></p>`+
          `<p class=\"mb-1 text-sm\">正確答案：<span class=\"font-semibold text-gray-700\">${t.options[t.answer]}</span></p>`+
          `<p class=\"text-xs text-gray-500 mt-2\">${t.explanation}</p>`+
          `</div>`+
          `<img src=\"${photos[i]}\" class=\"pdf-photo\">`+
          `</div>`;
    if((i+1)%3===0&&i<topics.length-1) html+=`<div class=\"page-break\"></div>`;
  });
  document.getElementById('summary-content').innerHTML=html;
}

function downloadPDF(){
  window.scrollTo(0,0);
  setTimeout(()=>{
    html2pdf(document.getElementById('summary-content'),{
      margin:0.5,filename:`國家防災日學習成果_${new Date().toISOString().slice(0,10).replace(/-/g,'')}.pdf`,image:{type:'jpeg',quality:0.98},html2canvas:{scale:2,useCORS:true,scrollY:-window.scrollY},jsPDF:{unit:'in',format:'a4',orientation:'portrait'}
    });
  },200);
}
</script>

</body>
</html>